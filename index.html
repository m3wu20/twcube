<!doctype html>
<html lang="zh-Hant">
<head>
Â  <meta charset="utf-8" />
Â  <meta name="viewport" content="width=device-width,initial-scale=1" />
Â  Â  <link rel="icon" type="image/png" href="favicon.png">
Â  <title>TWCUBEç¶²ç«™</title>
Â  <style>
Â  Â  /* ç”±æ–¼æ‚¨ç§»é™¤äº†åˆ‡æ›æŒ‰éˆ•ï¼Œæˆ‘å€‘å‡è¨­æ‚¨å¸Œæœ›ç¶²ç«™**é è¨­ç‚ºæ—¥å…‰æ¨¡å¼**ï¼Œä½†ä¿ç•™æ·±è‰²è®Šæ•¸ï¼Œä»¥ä¾¿æœªä¾†é€éç³»çµ±åå¥½æˆ–æ‰‹å‹•æ·»åŠ  'dark' class åˆ‡æ›ã€‚ */
Â  Â  :root{
Â  Â  Â  --bg: #f8fafc; --card:#ffffff; --text:#0b1220; --accent:#06b6d4; --muted:#475569; --glass:rgba(11,17,32,0.03);
Â  Â  Â  --radius:12px;
Â  Â  Â  --discord-color: #5865F2; /* Discord å“ç‰Œè‰² */
Â  Â  Â  --facebook-color: #1877F2; /* Facebook å“ç‰Œè‰² */
Â  Â  Â  --warning: #facc15; /* è­¦å‘Šè‰² */
Â  Â  }
Â  Â  /* æ·±è‰²ä¸»é¡Œè¨­å®š */
Â  Â  .dark{
Â  Â  Â  --bg:#071024; --card:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));
Â  Â  Â  --text:#e6eef6; --accent:#06b6d4; --muted:#94a3b8; --glass:rgba(255,255,255,0.03);
Â  Â  }
Â  Â  html,body{height:100%;margin:0;font-family:Inter, system-ui, -apple-system, "Segoe UI", Roboto, "Noto Sans", "Helvetica Neue", Arial}
Â  Â  body{background:var(--bg);color:var(--text);display:flex;align-items:flex-start;justify-content:center;padding:24px}
Â  Â  .container{width:100%;max-width:980px}

Â  Â  /* 1. å¡ç‰‡è¼‰å…¥å‹•ç•« */
Â  Â  @keyframes fadeInSlideUp {
Â  Â  Â  Â  from { opacity: 0; transform: translateY(20px); }
Â  Â  Â  Â  to { opacity: 1; transform: translateY(0); }
Â  Â  }
Â  Â Â 
Â  Â  .card{
Â  Â  Â  Â  background:var(--card);
Â  Â  Â  Â  border:1px solid rgba(0,0,0,0.04);
Â  Â  Â  Â  padding:20px;
Â  Â  Â  Â  border-radius:var(--radius);
Â  Â  Â  Â  box-shadow:0 8px 30px rgba(2,6,23,0.08);
Â  Â  Â  Â  animation: fadeInSlideUp 0.6s ease-out forwards;
Â  Â  Â  Â  opacity: 0;
Â  Â  Â  Â  margin-bottom: 20px;
Â  Â  }
Â  Â  .dark .card{box-shadow:0 8px 30px rgba(2,6,23,0.6);border:1px solid rgba(255,255,255,0.04)}
Â  Â  
    /* æ–°å¢çš„ç¶²ç«™ LOGO æ¨£å¼ */
    .header-logo {
        font-size: 24px; /* åœ–æ¨™å¤§å° */
        margin-right: 8px; /* èˆ‡æ–‡å­—çš„é–“è· */
        display: inline-block;
        vertical-align: middle; /* ç¢ºä¿èˆ‡æ–‡å­—å‚ç›´å°é½Š */
        transform: rotate(3deg); /* å¢åŠ ä¸€é»æ´»æ½‘æ„Ÿ */
    }

    h1{margin:0 0 8px;font-size:20px}
Â  Â  p.lead{margin:0 0 18px;color:var(--muted)}
Â  Â Â 
Â  Â  input,button,select{
Â  Â  Â  Â  padding:10px 12px;
Â  Â  Â  Â  border-radius:8px;
Â  Â  Â  Â  border:1px solid rgba(0,0,0,0.06);
Â  Â  Â  Â  background:transparent;
Â  Â  Â  Â  color:inherit;
Â  Â  Â  Â  font-size:14px;
Â  Â  Â  Â  transition: all 0.2s ease;
Â  Â  }
Â  Â  .dark input,.dark button,.dark select{border:1px solid rgba(255,255,255,0.04)}
Â  Â  input[type=text]{flex:1;min-width:200px}

Â  Â  input[type=text]:focus, select:focus {
Â  Â  Â  Â  border-color: var(--accent);
Â  Â  Â  Â  box-shadow: 0 0 0 2px rgba(6, 182, 212, 0.2);
Â  Â  Â  Â  outline: none;
Â  Â  }
Â  Â  button:hover {
Â  Â  Â  Â  background: var(--glass);
Â  Â  Â  Â  transform: translateY(-1px);
Â  Â  }
Â  Â  button:active {
Â  Â  Â  Â  transform: translateY(0);
Â  Â  Â  Â  box-shadow: none;
Â  Â  }

Â  Â  .controls{display:flex;gap:8px;align-items:center;margin-bottom:12px}
Â  Â  .results{margin-top:12px}
Â  Â  .year-group{margin-top:12px}
Â  Â Â 
Â  Â  /* 3. å¹´åˆ†æ¨™é¡Œçš„å‹•ç•« */
Â  Â  @keyframes slideInYear {
Â  Â  Â  Â  from { opacity: 0; transform: translateX(-10px); }
Â  Â  Â  Â  to { opacity: 1; transform: translateX(0); }
Â  Â  }
Â  Â  .year-title{
Â  Â  Â  Â  font-weight:700;margin:12px 0 6px;
Â  Â  Â  Â  display:flex;align-items:center;gap:8px;
Â  Â  Â  Â  animation: slideInYear 0.4s ease-out forwards;Â 
Â  Â  Â  Â  opacity: 0;
Â  Â  }

Â  Â  /* 2. åˆ—è¡¨é …ç›®æ‡¸åœæ•ˆæœ */
Â  Â  .item{
Â  Â  Â  Â  padding:12px;
Â  Â  Â  Â  border-radius:8px;
Â  Â  Â  Â  background:var(--glass);
Â  Â  Â  Â  border:1px solid rgba(0,0,0,0.03);
Â  Â  Â  Â  display:grid;
Â  Â  Â  Â  grid-template-columns:1fr auto;
Â  Â  Â  Â  gap:8px;
Â  Â  Â  Â  align-items:center;
Â  Â  Â  Â  margin-bottom:8px;
Â  Â  Â  Â  cursor: pointer;Â 
Â  Â  Â  Â  transition: transform 0.2s ease, box-shadow 0.2s ease, border-color 0.2s ease;
Â  Â  }
Â  Â  .item:hover {
Â  Â  Â  Â  transform: translateY(-2px) scale(1.005);Â 
Â  Â  Â  Â  box-shadow: 0 10px 20px rgba(2,6,23,0.1);Â 
Â  Â  Â  Â  border-color: var(--accent);Â 
Â  Â  }
Â  Â  .dark .item{border:1px solid rgba(255,255,255,0.02)}
Â  Â  .dark .item:hover {
Â  Â  Â  Â  box-shadow: 0 10px 20px rgba(2,6,23,0.8);
Â  Â  Â  Â  border-color: var(--accent);
Â  Â  }

Â  Â  .meta{color:var(--muted);font-size:13px}
Â  Â  .link{color:var(--accent);text-decoration:none}
Â  Â  .small{font-size:13px;color:var(--muted)}
Â  Â  .toolbar{display:flex;gap:8px;align-items:center;margin-bottom:12px}
Â  Â Â 
Â  Â  .icon-btn{
Â  Â  Â  Â  width:36px; height:36px; border-radius:8px; display:inline-flex;
Â  Â  Â  Â  align-items:center; justify-content:center; cursor:pointer;
Â  Â  Â  Â  border:1px solid rgba(0,0,0,0.06); background:transparent;
Â  Â  Â  Â  transition: transform 0.2s ease, background 0.2s ease;
Â  Â  }
Â  Â  .dark .icon-btn{border:1px solid rgba(255,255,255,0.04)}
Â  Â  .icon-btn:active { transform: rotate(15deg); background: var(--glass); }

Â  Â  .countdown{margin-top:4px;font-size:13px;font-weight:600;display:flex;align-items:center;gap:6px}
Â  Â  .light-lamp{width:10px;height:10px;border-radius:50%;display:inline-block}
Â  Â  .green{background:#22c55e}
Â  Â  .yellow{background:#eab308}
Â  Â  .red{background:#ef4444}
Â  Â  footer{margin-top:14px;color:var(--muted);font-size:13px}
Â  Â Â 
Â  Â  /* 4. ç‹€æ…‹è¨Šæ¯çš„æ·¡å…¥æ·¡å‡º */
Â  Â  .status{
Â  Â  Â  Â  margin-top:8px; color:var(--muted); font-size:13px; opacity: 1;
Â  Â  Â  Â  transition: opacity 0.3s ease;
Â  Â  }
Â  Â  .status.fade-out { opacity: 0; }

Â  Â  /* 5. Modal æ¨£å¼ */
Â  Â  .modal-backdrop {
Â  Â  Â  position: fixed; top: 0; left: 0; width: 100%; height: 100%;
Â  Â  Â  background: rgba(0, 0, 0, 0.4); backdrop-filter: blur(4px); z-index: 1000;
Â  Â  Â  display: none; opacity: 0; transition: opacity 0.3s ease;
Â  Â  Â  justify-content: center; align-items: center;
Â  Â  }
Â  Â  .modal-content {
Â  Â  Â  background: var(--card); padding: 30px; border-radius: var(--radius);
Â  Â  Â  width: 90%; max-width: 500px; box-shadow: 0 10px 40px rgba(0,0,0,0.3);
Â  Â  Â  transform: scale(0.9); transition: transform 0.3s ease;
Â  Â  }
Â  Â  .modal-backdrop.is-open { display: flex; opacity: 1; }
Â  Â  .modal-backdrop.is-open .modal-content { transform: scale(1); }
Â  Â  .dark .modal-content{box-shadow: 0 10px 40px rgba(0,0,0,0.8);}
Â  Â  .modal-title {font-size: 24px; margin-top: 0; margin-bottom: 15px;}
Â  Â  .modal-info div {margin-bottom: 8px; font-size: 15px; line-height: 1.4;}
Â  Â  .modal-info strong {font-weight: 600; color: var(--text);}
Â  Â  .modal-close-btn {
Â  Â  Â  position: absolute; top: 15px; right: 15px; background: none; border: none;
Â  Â  Â  font-size: 24px; cursor: pointer; color: var(--muted); transition: color 0.2s;
Â  Â  }
Â  Â  .modal-close-btn:hover {color: var(--text);}
Â  Â  .modal-link-btn {
Â  Â  Â  Â  display: block; width: 100%; text-align: center; margin-top: 20px;
Â  Â  Â  Â  padding: 10px; background: var(--accent); color: white; border-radius: 8px;
Â  Â  Â  Â  text-decoration: none; font-weight: 600; transition: background-color 0.2s ease;
Â  Â  }
Â  Â  .modal-link-btn:hover { background: #0097a7; }

Â  Â  /* 6. è¯çµ¡è³‡è¨Šå€å¡Šæ¨£å¼ - çªå‡ºå€‹äººè³‡è¨Š */
Â  Â  .contact-panel {
Â  Â  Â  Â  padding: 15px 0;
Â  Â  }
Â  Â  .contact-group {
Â  Â  Â  Â  margin-bottom: 25px;
Â  Â  Â  Â  padding: 20px;
Â  Â  Â  Â  border-radius: var(--radius);
Â  Â  Â  Â  background: var(--glass);
Â  Â  Â  Â  border: 2px solid var(--accent); /* çªå‡ºé‚Šæ¡† */
Â  Â  Â  Â  box-shadow: 0 4px 15px rgba(6, 182, 212, 0.1);
Â  Â  }
Â  Â  .dark .contact-group {
Â  Â  Â  Â  border: 2px solid var(--accent);
Â  Â  Â  Â  box-shadow: 0 4px 15px rgba(6, 182, 212, 0.3);
Â  Â  }
Â  Â  .contact-title {
Â  Â  Â  Â  font-size: 20px;
Â  Â  Â  Â  font-weight: 700;
Â  Â  Â  Â  margin-top: 0;
Â  Â  Â  Â  margin-bottom: 15px;
Â  Â  Â  Â  color: var(--accent);
Â  Â  }
Â  Â  .info-item {
Â  Â  Â  Â  display: flex;
Â  Â  Â  Â  align-items: center;
Â  Â  Â  Â  gap: 12px;
Â  Â  Â  Â  margin-bottom: 15px;
Â  Â  Â  Â  font-size: 16px;
Â  Â  Â  Â  padding: 8px 0;
Â  Â  Â  Â  border-bottom: 1px dashed rgba(0,0,0,0.1);
Â  Â  }
Â  Â  .dark .info-item {
Â  Â  Â  Â  border-bottom: 1px dashed rgba(255,255,255,0.1);
Â  Â  }
Â  Â  .info-item:last-child {
Â  Â  Â  Â  margin-bottom: 0;
Â  Â  Â  Â  border-bottom: none;
Â  Â  }
Â  Â  .info-item i {
Â  Â  Â  Â  font-size: 20px;
Â  Â  Â  Â  color: var(--muted);
Â  Â  }
Â  Â  .info-item a {
Â  Â  Â  Â  color: var(--text);
Â  Â  Â  Â  text-decoration: none;
Â  Â  Â  Â  font-weight: 600;
Â  Â  Â  Â  word-break: break-all;
Â  Â  }
Â  Â  .info-item a:hover {
Â  Â  Â  Â  color: var(--accent);
Â  Â  }

Â  Â  /* 9. æ–°å¢çš„å‚™è¨»æ¨£å¼ */
Â  Â  .note-box {
Â  Â  Â  Â  margin-top: 20px;
Â  Â  Â  Â  padding: 15px;
Â  Â  Â  Â  border-radius: 8px;
Â  Â  Â  Â  background: rgba(250, 204, 21, 0.1); /* æ·ºé»ƒè‰²èƒŒæ™¯ */
Â  Â  Â  Â  border-left: 5px solid var(--warning);
Â  Â  Â  Â  color: var(--text);
Â  Â  Â  Â  font-size: 14px;
Â  Â  Â  Â  font-weight: 500;
Â  Â  Â  Â  line-height: 1.5;
Â  Â  }
Â  Â  .dark .note-box {
Â  Â  Â  Â  background: rgba(250, 204, 21, 0.05);
Â  Â  }
Â  Â Â 
Â  Â  /* 7. Tab å°èˆªæ¨£å¼ */
Â  Â  .tab-nav { display: flex; gap: 5px; margin-bottom: 15px; }
Â  Â  .tab-button {
Â  Â  Â  Â  padding: 10px 15px; border: none; background: var(--glass);
Â  Â  Â  Â  color: var(--muted); font-weight: 600; cursor: pointer;
Â  Â  Â  Â  border-radius: var(--radius) var(--radius) 0 0;
Â  Â  Â  Â  border-bottom: 3px solid transparent; transition: all 0.2s ease;
Â  Â  }
Â  Â  .tab-button.active {
Â  Â  Â  Â  background: var(--card); color: var(--accent);
Â  Â  Â  Â  border-bottom: 3px solid var(--accent);
Â  Â  Â  Â  box-shadow: 0 -4px 10px rgba(0,0,0,0.05);
Â  Â  }

Â  Â  /* 8. Tab å…§å®¹æ¨£å¼ */
Â  Â  .tab-content {
Â  Â  Â  Â  display: none;
Â  Â  Â  Â  min-height: 300px;
Â  Â  }
Â  Â  .tab-content.active { display: block; }
Â  </style>
Â  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css" integrity="sha512-Fo3rlrZj/k7ujTnHg4C0A/Q3w7aN33yFz5q81Hk+f/8x/vU4v9i93cT3N2Jz4XyFq7O7Qp5K+fQ95TzE8P/vA==" crossorigin="anonymous" referrerpolicy="no-referrer" />
</head>
<body>
<div class="container">
Â  <div class="card">
Â  Â  <div style="display:flex;justify-content:space-between;align-items:center;gap:12px">
Â  Â  Â  <div>
Â  Â  Â  Â  <h1>
          <span class="header-logo">ğŸ§Š</span>
          TWCUBEç¶²ç«™
        </h1>
Â  Â  Â  Â  <p class="lead">WCA å°ç£æ¯”è³½èˆ‡å€‹äººè¯çµ¡è³‡æº ğŸ‡¹ğŸ‡¼</p>
Â  Â  Â  </div>
      Â  Â  </div>

Â  Â  <div class="tab-nav" id="tabNav">
Â  Â  Â  Â  <button class="tab-button active" data-tab="competitions">ğŸ—“ï¸ æ¯”è³½æŸ¥è©¢</button>
Â  Â  Â  Â  <button class="tab-button" data-tab="contact">ğŸ“ è¯çµ¡è³‡è¨Š</button>
Â  Â  </div>
Â  Â Â 
Â  Â  <div id="competitionsPanel" class="tab-content active">
Â  Â  Â  Â  <h2>WCA è³½äº‹åˆ—è¡¨ (å°ç£)</h2>
Â  Â  Â  Â  <div class="controls">
Â  Â  Â  Â  Â  <input id="q" type="text" placeholder="æœå°‹åç¨± / åŸå¸‚ / å¹´ä»½ / ä»£ç¢¼ï¼ˆæ¨¡ç³Šæœå°‹ï¼‰" />
Â  Â  Â  Â  Â  <button id="clearBtn" type="button">æ¸…é™¤</button>
Â  Â  Â  Â  </div>

Â  Â  Â  Â  <div id="status" class="status">è¼‰å…¥ä¸­â€¦</div>
Â  Â  Â  Â  <div id="results" class="results"></div>

Â  Â  Â  Â  <footer>
Â  Â  Â  Â  Â  å°æé†’ï¼šé»æ“Šæ¯”è³½å¯æŸ¥çœ‹è©³ç´°è³‡è¨Šï¼Œå€’æ•¸ä»¥æ¯”è³½é–‹å§‹æ—¥ç‚ºåŸºæº–ã€‚
Â  Â  Â  Â  </footer>
Â  Â  </div>

Â  Â  <div id="contactPanel" class="tab-content">
Â  Â  Â  Â  <h2>å»ºç«‹è€…å€‹äººè¯çµ¡æ–¹å¼</h2>
Â  Â  Â  Â Â 
Â  Â  Â  Â  <div class="contact-panel">

Â  Â  Â  Â  Â  Â  <div class="contact-group">
Â  Â  Â  Â  Â  Â  Â  Â  <div class="contact-title">ç¶²ç«™å»ºç«‹èˆ‡ç¶­è­·è€…</div>
Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  <div class="info-item">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <i class="fab fa-discord" style="color: #5865F2;"></i>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <span>Discord é‚€è«‹é€£çµï¼š
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <a href="https://discord.gg/y2gxYtmXp7" target="_blank">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  https://discord.gg/y2gxYtmXp7
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </a>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span>
Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  <div class="info-item">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <i class="far fa-envelope" style="color: #ea4335;"></i>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <span>Gmail é›»å­éƒµä»¶ï¼š
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <a href="mailto:swxhzop@gmail.com">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  swxhzop@gmail.com
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </a>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span>
Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  <div class="note-box">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  âš ï¸ å‚™è¨»ï¼šæœ¬ç«™ç¶­è­·è€…ç‚ºä¸€åå­¸ç”Ÿï¼Œå› æ­¤å›è¦†å¯èƒ½æœƒæ¯”è¼ƒæ…¢ã€‚<br>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  **å»ºè­°ä½¿ç”¨ Discord è¯çµ¡ï¼Œæœƒæ¯”è¼ƒå¿«é€Ÿå¾—åˆ°å›è¦†ã€‚**
Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  </div>

Â  Â  Â  Â  Â  Â  <p class="small" style="margin-top: 20px; color: var(--muted);">
Â  Â  Â  Â  Â  Â  Â  Â  å¦‚æœæ‚¨å°æœ¬ç¶²ç«™æœ‰ä»»ä½•å»ºè­°ã€åˆä½œæ„å‘æˆ–æŠ€è¡“å•é¡Œï¼Œæ­¡è¿é€éä»¥ä¸Šæ–¹å¼è¯çµ¡ã€‚
Â  Â  Â  Â  Â  Â  </p>
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  </div>
Â  Â  </div>

Â  </div>
</div>

<div id="compModalBackdrop" class="modal-backdrop">
Â  <div id="compModal" class="modal-content" style="position: relative;">
Â  Â  <button id="modalCloseBtn" class="modal-close-btn" title="é—œé–‰è¦–çª—">Ã—</button>
Â  Â  <h2 id="modalTitle" class="modal-title">æ¯”è³½åç¨±</h2>
Â  Â  <div id="modalInfo" class="modal-info">
Â  Â  Â  </div>
Â  Â  <a id="modalLink" class="modal-link-btn" href="#" target="_blank">å‰å¾€ WCA è©³ç´°é é¢ â†’</a>
Â  </div>
</div>


<script>
const API_BASE_COMP='https://www.worldcubeassociation.org/api/v0/competitions';

// WCA é …ç›®åç¨±æ˜ å°„
const WCA_EVENTS = {
Â  Â  '333': 'ä¸‰éš (3x3x3)', '222': 'äºŒéš (2x2x2)', '444': 'å››éš (4x4x4)', '555': 'äº”éš (5x5x5)',
Â  Â  '666': 'å…­éš (6x6x6)', '777': 'ä¸ƒéš (7x7x7)', '333bf': 'ä¸‰éšç›²è§£', '333fm': 'æœ€å°‘æ­¥',
Â  Â  '333oh': 'å–®æ‰‹', 'minx': 'äº”é­”æ–¹', 'pyram': 'é‡‘å­—å¡”', 'sq1': 'SQ-1',
Â  Â  'clock': 'é­”éŒ¶ (Clock)', 'skewb': 'æ–œè½‰ (Skewb)', '444bf': 'å››éšç›²è§£', '555bf': 'äº”éšç›²è§£'
};

// æ¯”è³½æŸ¥è©¢ DOM
const qEl=document.getElementById('q');
const resultsEl=document.getElementById('results');
const statusEl=document.getElementById('status');
const clearBtn=document.getElementById('clearBtn');

// Tab DOM
const tabNavEl = document.getElementById('tabNav');
const competitionsPanelEl = document.getElementById('competitionsPanel');
const contactPanelEl = document.getElementById('contactPanel'); // è¯çµ¡è³‡è¨Šé¢æ¿

// Modal DOM
const modalBackdrop = document.getElementById('compModalBackdrop');
const modalCloseBtn = document.getElementById('modalCloseBtn');
const modalTitle = document.getElementById('modalTitle');
const modalInfo = document.getElementById('modalInfo');
const modalLink = document.getElementById('modalLink');


// ----------------------------------------------------------------
// --- Tab & é€šç”¨åŠŸèƒ½ ---
// ----------------------------------------------------------------

function switchTab(targetTab) {
Â  Â  // ç§»é™¤æ‰€æœ‰ Tab æŒ‰éˆ•å’Œå…§å®¹çš„ active ç‹€æ…‹
Â  Â  document.querySelectorAll('.tab-button').forEach(btn => btn.classList.remove('active'));
Â  Â  document.querySelectorAll('.tab-content').forEach(content => content.classList.remove('active'));

Â  Â  // è¨­å®šç›®æ¨™ Tab ç‚º active
Â  Â  const targetBtn = document.querySelector(`.tab-button[data-tab="${targetTab}"]`);
Â  Â  if (targetBtn) targetBtn.classList.add('active');

Â  Â  if (targetTab === 'competitions') {
Â  Â  Â  Â  competitionsPanelEl.classList.add('active');
Â  Â  Â  Â  statusEl.textContent = cache ? `å·²è¼‰å…¥ ${cache.length} ç­†æ¯”è³½è³‡æ–™ã€‚` : 'è¼‰å…¥ä¸­â€¦';
Â  Â  } else if (targetTab === 'contact') {
Â  Â  Â  Â  contactPanelEl.classList.add('active');
Â  Â  }
}

tabNavEl.addEventListener('click', (e) => {
Â  Â  if (e.target.classList.contains('tab-button')) {
Â  Â  Â  Â  switchTab(e.target.dataset.tab);
Â  Â  }
});

// ----------------------------------------------------------------
// --- æ¯”è³½æŸ¥è©¢åŠŸèƒ½ (Modal/Countdown) ---
// ----------------------------------------------------------------

function formatDateRange(start,end){
Â  try{
Â  Â  const s=new Date(start).toLocaleDateString();
Â  Â  const e=new Date(end).toLocaleDateString();
Â  Â  return s===e?s:`${s} â€” ${e}`;
Â  }catch(e){return start||''}
}

async function showModal(c) {
Â  Â  modalTitle.textContent = c.name;
Â  Â  modalInfo.innerHTML = `
Â  Â  Â  Â  <div><strong>åœ°é»ï¼š</strong> ${c.city}, ${c.country_name}</div>
Â  Â  Â  Â  <div><strong>ä»£ç¢¼ï¼š</strong> ${c.id}</div>
Â  Â  Â  Â  <div><strong>æ—¥æœŸï¼š</strong> ${formatDateRange(c.start_date, c.end_date)}</div>
Â  Â  Â  Â  <div><strong>ä¸»è¾¦æ–¹ï¼š</strong> ${c.organizer || c.organizer_name || '-'}</div>
Â  Â  Â  Â  <div><strong>ç‹€æ…‹ï¼š</strong> ${c.registration_open ? 'âœ… å ±åé–‹æ”¾ä¸­' : 'âŒ å ±åå°šæœªé–‹æ”¾'}</div>
Â  Â  Â  Â  <div id="modalRecordStatus" style="margin-top: 15px; border-top: 1px solid var(--glass); padding-top: 10px;">
Â  Â  Â  Â  Â  <strong>ç´€éŒ„æ©Ÿæœƒï¼š</strong> è¼‰å…¥ä¸­...
Â  Â  Â  Â  </div>
Â  Â  `;
Â  Â  modalLink.href = `https://www.worldcubeassociation.org/competitions/${c.id}`;
Â  Â Â 
Â  Â  // é¡¯ç¤º Modal
Â  Â  modalBackdrop.classList.add('is-open');
Â  Â  document.body.style.overflow = 'hidden';

Â  Â  // *** Google æœç´¢åˆ¤æ–·ç´€éŒ„æ©Ÿæœƒ ***
Â  Â  const recordStatusEl = document.getElementById('modalRecordStatus');
Â  Â Â 
Â  Â  let statusText = 'ğŸ† <strong>åœ‹å®¶ç´€éŒ„ (NR)</strong>ï¼šå¯æŒ‘æˆ°';Â 
Â  Â  let hasWR = false;

Â  Â  const query = `${c.name} WCA competition type`;Â 
Â  Â  // å‘¼å« Google æœå°‹å·¥å…·
Â  Â  try {
Â  Â  Â  Â  const searchResult = await google.search([query]);
Â  Â  Â  Â  const snippet = searchResult.snippets.map(s => s.toLowerCase()).join(' ');

Â  Â  Â  Â  if (snippet.includes('world championship') || snippet.includes('wr') || c.name.toLowerCase().includes('world championship')) {
Â  Â  Â  Â  Â  Â  hasWR = true;
Â  Â  Â  Â  } else if (snippet.includes('continental championship') || snippet.includes('asian championship') || snippet.includes('cr')) {
Â  Â  Â  Â  Â  Â  statusText += '<br>ğŸŒ <strong>æ´²éš›ç´€éŒ„ (CR)</strong>ï¼šå¯æŒ‘æˆ°';
Â  Â  Â  Â  }

Â  Â  Â  Â  if (hasWR) {
Â  Â  Â  Â  Â  Â  statusText = 'ğŸ‘‘ <strong>ä¸–ç•Œç´€éŒ„ (WR)</strong>ï¼šå¯æŒ‘æˆ°<br>' + statusText;
Â  Â  Â  Â  }

Â  Â  Â  Â  recordStatusEl.innerHTML = `<strong>ç´€éŒ„æ©Ÿæœƒï¼š</strong><br>${statusText}`;

Â  Â  } catch (e) {
Â  Â  Â  Â  recordStatusEl.innerHTML = `<strong>ç´€éŒ„æ©Ÿæœƒï¼š</strong><br>${statusText} <span class="small">(è©³ç´°è³‡è¨Šè¼‰å…¥å¤±æ•—)</span>`;
Â  Â  }
}

function closeModal() {
Â  Â  modalBackdrop.classList.remove('is-open');
Â  Â  document.body.style.overflow = '';Â 
}

// é—œé–‰ Modal çš„äº‹ä»¶ç›£è½å™¨
modalCloseBtn.addEventListener('click', closeModal);
modalBackdrop.addEventListener('click', (e) => {
Â  Â  if (e.target === modalBackdrop) {
Â  Â  Â  Â  closeModal();
Â  Â  }
});
document.addEventListener('keydown', (e) => {
Â  Â  if (e.key === 'Escape' && modalBackdrop.classList.contains('is-open')) {
Â  Â  Â  Â  closeModal();
Â  Â  }
});


function renderItem(c){
Â  const div=document.createElement('div');
Â  div.className='item';
Â Â 
Â  div.addEventListener('click', () => showModal(c));

Â  const left=document.createElement('div');
Â  left.innerHTML=`<div style="font-weight:600">${c.name}</div>
Â  <div class="meta">${c.city||'-'}, ${c.country_name||'-'} â€¢ ${formatDateRange(c.start_date,c.end_date)}</div>
Â  <div class="small">ä¸»è¾¦ï¼š${c.organizer||c.organizer_name||'-'}</div>`;

Â  const cdDiv=document.createElement('div');
Â  cdDiv.className='countdown';
Â  const lamp=document.createElement('span');
Â  lamp.className='light-lamp';
Â  const start=new Date(c.start_date);
Â  const end=new Date(c.end_date);

Â  function updateCountdown(){
Â  Â  const now=new Date();
Â  Â  if (now > end) {
Â  Â  Â  lamp.className='light-lamp red';
Â  Â  Â  cdDiv.textContent='æ¯”è³½å·²çµæŸ';
Â  Â  Â  return;
Â  Â  }
Â  Â Â 
Â  Â  if(c.registration_open){
Â  Â  Â  lamp.className='light-lamp green';
Â  Â  Â  const diff=start-now;
Â  Â  Â  if(diff>0){
Â  Â  Â  Â  const d=Math.floor(diff/86400000);
Â  Â  Â  Â  const h=Math.floor(diff%86400000/3600000);
Â  Â  Â  Â  const m=Math.floor(diff%3600000/60000);
Â  Â  Â  Â  const s=Math.floor(diff%60000/1000);
Â  Â  Â  Â  cdDiv.textContent=`è·é›¢æ¯”è³½é–‹å§‹ï¼š${d}å¤© ${h}æ™‚ ${m}åˆ† ${s}ç§’`;
Â  Â  Â  }else{
Â  Â  Â  Â  lamp.className='light-lamp green';
Â  Â  Â  Â  cdDiv.textContent='æ¯”è³½é€²è¡Œä¸­';
Â  Â  Â  }
Â  Â  }else{
Â  Â  Â  const diff=start-now;
Â  Â  Â  if(diff>0){
Â  Â  Â  Â  if(diff<3*86400000){lamp.className='light-lamp yellow';}
Â  Â  Â  Â  else{lamp.className='light-lamp red';}Â 
Â  Â  Â  Â Â 
Â  Â  Â  Â  const d=Math.floor(diff/86400000);
Â  Â  Â  Â  const h=Math.floor(diff%86400000/3600000);
Â  Â  Â  Â  const m=Math.floor(diff%3600000/60000);
Â  Â  Â  Â  const s=Math.floor(diff%60000/1000);
Â  Â  Â  Â  cdDiv.textContent=`è·é›¢æ¯”è³½é–‹å§‹ï¼š${d}å¤© ${h}æ™‚ ${m}åˆ† ${s}ç§’`;
Â  Â  Â  }else{
Â  Â  Â  Â  lamp.className='light-lamp red';
Â  Â  Â  Â  cdDiv.textContent='å ±åå·²æˆªæ­¢/å·²çµæŸ';
Â  Â  Â  }
Â  Â  }
Â  Â  cdDiv.prepend(lamp);
Â  }
Â  updateCountdown();
Â  const intervalId = setInterval(updateCountdown, 1000);
Â Â 
Â  div.cleanup = () => clearInterval(intervalId);


Â  div.appendChild(left);
Â  const right=document.createElement('div');
Â  right.style.width = '100px';Â 
Â  right.style.textAlign = 'right';
Â  right.innerHTML=`<span class="small" style="color:var(--accent); display:block;">é»æ“Šçœ‹è©³æƒ…</span>`;Â 
Â  div.appendChild(right);
Â  div.appendChild(cdDiv);
Â Â 
Â  return div;
}

function groupByYear(data){
Â  const groups={};
Â  data.forEach(c=>{
Â  Â  const year=c.start_date?new Date(c.start_date).getFullYear():'æœªçŸ¥';
Â  Â  if(!groups[year]) groups[year]=[];
Â  Â  groups[year].push(c);
Â  });
Â  const sortedYears=Object.keys(groups).sort((a,b)=>b-a);
Â  return {groups,sortedYears};
}

async function fetchAllTaiwanCompetitions(){
Â  statusEl.classList.add('fade-out');
Â  await new Promise(r => setTimeout(r, 300));

Â  statusEl.textContent='æ­£åœ¨å¾ WCA å–å¾—å°ç£æ¯”è³½ï¼ˆé€é æŠ“å–â€¦ï¼‰';
Â  statusEl.classList.remove('fade-out');
Â  let page=1; const per_page=100; let all=[];
Â  try{
Â  Â  while(true){
Â  Â  Â  // æ³¨æ„ï¼šä½¿ç”¨ API_BASE_COMP
Â  Â  Â  const url=`${API_BASE_COMP}?country_iso2=TW&per_page=${per_page}&page=${page}`;
Â  Â  Â  const res=await fetch(url);
Â  Â  Â  if(!res.ok) throw new Error('HTTP '+res.status);
Â  Â  Â  const data=await res.json();
Â  Â  Â  if(!Array.isArray(data)||data.length===0) break;
Â  Â  Â  all=all.concat(data);
Â  Â  Â  statusEl.textContent=`å·²å–å¾— ${all.length} ç­†ï¼ˆç¬¬ ${page} é ï¼‰...`;
Â  Â  Â  if(data.length<per_page) break;
Â  Â  Â  page+=1;
Â  Â  Â  await new Promise(r=>setTimeout(r,150));
Â  Â  }
Â  Â  statusEl.classList.add('fade-out');
Â  Â  await new Promise(r => setTimeout(r, 300));
Â  Â  statusEl.textContent=`å…¨éƒ¨è¼‰å…¥å®Œæˆï¼Œå…± ${all.length} ç­†è³‡æ–™ã€‚`;
Â  Â  statusEl.classList.remove('fade-out');
Â  Â  return all;
Â  }catch(err){
Â  Â  statusEl.classList.add('fade-out');
Â  Â  await new Promise(r => setTimeout(r, 300));
Â  Â  console.error(err);Â 
Â  Â  statusEl.textContent='ç„¡æ³•å®Œæ•´å–å¾— WCA APIï¼š'+err.message;Â 
Â  Â  statusEl.classList.remove('fade-out');
Â  Â  throw err;
Â  }
}

let cache=null;

function renderGroups(groupsObj,q){
Â  Array.from(resultsEl.querySelectorAll('.item')).forEach(item => {
Â  Â  if (item.cleanup) item.cleanup();
Â  });
Â Â 
Â  resultsEl.innerHTML='';
Â  const {groups,sortedYears}=groupsObj;
Â  sortedYears.forEach((year, yearIndex)=>{
Â  Â  const yearDiv=document.createElement('div'); yearDiv.className='year-group';
Â  Â  const title=document.createElement('div');Â 
Â  Â  title.className='year-title';Â 
Â  Â  title.innerHTML=`ğŸ“… ${year} å¹´`;
Â  Â  title.style.animationDelay = `${yearIndex * 0.1}s`;Â 
Â  Â  yearDiv.appendChild(title);
Â  Â  const list=document.createElement('div');
Â  Â  const items=groups[year].filter(c=>{
Â  Â  Â  if(!q) return true;
Â  Â  Â  const ql=q.toLowerCase();
Â  Â  Â  return (c.name&&c.name.toLowerCase().includes(ql))||(c.city&&c.city.toLowerCase().includes(ql))||(c.id&&c.id.toLowerCase().includes(ql))||(c.start_date&&new Date(c.start_date).getFullYear().toString().includes(ql));
Â  Â  });
Â  Â  if(items.length===0){
Â  Â  Â  const none=document.createElement('div'); none.className='small'; none.textContent='ï¼ˆç„¡ç¬¦åˆé …ç›®ï¼‰'; list.appendChild(none);
Â  Â  }else{
Â  Â  Â  items.sort((a,b)=>new Date(b.start_date)-new Date(a.start_date)).forEach(c=>list.appendChild(renderItem(c)));
Â  Â  }
Â  Â  yearDiv.appendChild(list);
Â  Â  resultsEl.appendChild(yearDiv);
Â  });
}

let searchTimer=null;
function liveSearch(){
Â  const q=qEl.value.trim();
Â  if(!cache) return;
Â  clearTimeout(searchTimer);
Â  searchTimer=setTimeout(async ()=>{
Â  Â  statusEl.classList.add('fade-out');
Â  Â  await new Promise(r => setTimeout(r, 300));

Â  Â  renderGroups(groupByYear(cache),q);Â 
Â  Â  const filteredCount = Array.from(resultsEl.querySelectorAll('.item')).length;
Â  Â  statusEl.textContent=`å·²éæ¿¾å‡º ${filteredCount} ç­†çµæœï¼ˆæœå°‹ï¼š\"${q||'å…¨éƒ¨'}\"ï¼‰`;
Â  Â  statusEl.classList.remove('fade-out');
Â  },180);
}

qEl.addEventListener('input',liveSearch);
clearBtn.addEventListener('click',async ()=>{
Â  Â  qEl.value=''; qEl.focus();Â 
Â  Â  if(cache){
Â  Â  Â  Â  statusEl.classList.add('fade-out');
Â  Â  Â  Â  await new Promise(r => setTimeout(r, 300));

Â  Â  Â  Â  renderGroups(groupByYear(cache),'');Â 
Â  Â  Â  Â  statusEl.textContent=`å·²æ¸…é™¤ç¯©é¸ï¼Œå…± ${cache.length} ç­†è³‡æ–™ã€‚`;
Â  Â  Â  Â  statusEl.classList.remove('fade-out');
Â  Â  }
});


// ----------------------------------------------------------------
// --- åˆå§‹åŒ– ---
// ----------------------------------------------------------------

(async()=>{
Â  // 1. è¼‰å…¥æ¯”è³½è³‡æ–™
Â  cache=await fetchAllTaiwanCompetitions();
Â  const seen=new Set();
Â  // éæ¿¾é‡è¤‡çš„æ¯”è³½ID
Â  cache=cache.filter(c=>{if(seen.has(c.id)) return false; seen.add(c.id); return true;});
Â  renderGroups(groupByYear(cache),'');

Â  // 2. é è¨­é¡¯ç¤ºæ¯”è³½é¢æ¿
Â  switchTab('competitions');Â 
})();
</script>
</body>
</html>
